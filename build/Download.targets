<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<UsingTask TaskName="DownloadFile" AssemblyFile="$(MSBuildThisFileDirectory)/../build/Palaso.BuildTasks.dll" />

	<PropertyGroup>
		<DownloadDir>$(MSBuildThisFileDirectory)/../Download</DownloadDir>
		<!-- bt196 is the output from L10NSharp continuous (Windows) build. This is also used on Linux. -->
		<L10NSharpUrl>http://build.palaso.org/guestAuth/repository/download/bt196/.lastSuccessful</L10NSharpUrl>
		<!-- bt281 is the output from icucil-precise64-default continuous build -->
		<!--<IcuCilUrl Condition="'$(OS)'=='Unix'">http://build.palaso.org/guestAuth/repository/download/bt281/.lastSuccessful</IcuCilUrl>-->
		<IcuCilUrl Condition="'$(OS)'=='Unix'">http://build.palaso.org/guestAuth/repository/download/bt281/0.1.44.e6db4679b030</IcuCilUrl>
		<!-- bt14 is the output from icucil-win32-default continuous build -->
		<!--<IcuCilUrl Condition="'$(OS)'!='Unix'">http://build.palaso.org/guestAuth/repository/download/bt14/.lastSuccessful</IcuCilUrl>-->
		<IcuCilUrl Condition="'$(OS)'!='Unix'">http://build.palaso.org/guestAuth/repository/download/bt14/*.*.53</IcuCilUrl>
	</PropertyGroup>

	<ItemGroup>
		<L10NSharpFiles Include="$(DownloadDir)/L10NSharp.dll"/>
		<IcuCilFiles Include="$(DownloadDir)/icu.net.dll"/>
		<IcuCilFiles Include="$(DownloadDir)/icu.net.dll.config"/>
	</ItemGroup>

	<Target Name="BeforeBuild">
		<MakeDir Directories="$(DownloadDir)"/>
		<DownloadFile Address="$(L10NSharpUrl)/L10NSharp.dll"
					  LocalFilename="$(DownloadDir)/L10NSharp.dll"/>
		<DownloadFile Address="$(IcuCilUrl)/icu.net.dll"
					  LocalFilename="$(DownloadDir)/icu.net.dll"/>
		<DownloadFile Address="$(IcuCilUrl)/icu.net.dll.config"
					  LocalFilename="$(DownloadDir)/icu.net.dll.config"/>
		<!-- split into two stages so that if the net connection fails, you still have the old files -->
		<MakeDir Directories="$(MSBuildThisFileDirectory)/../packages/L10NSharp.1.1.3/lib/net40-Client"/>
		<Copy SourceFiles="@(L10NSharpFiles)"
			  DestinationFolder="$(MSBuildThisFileDirectory)/../packages/L10NSharp.1.1.3/lib/net40-Client"
			  SkipUnchangedFiles="true"/>
		<Copy SourceFiles="@(L10NSharpFiles)"
			  DestinationFolder="$(MSBuildThisFileDirectory)/../lib/$(Configuration)"
			  SkipUnchangedFiles="true"/>
		<Copy SourceFiles="@(IcuCilFiles)"
			  DestinationFolder="$(MSBuildThisFileDirectory)/../lib/$(Configuration)"
			  SkipUnchangedFiles="true"/>
	</Target>

</Project>
